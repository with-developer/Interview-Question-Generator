<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="{{ url_for('static', filename='logo/favicon.png') }}">

  <title>당면행</title>

  <!-- Bootstrap 5.0 CSS CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.0/css/bootstrap.min.css"
    integrity="sha512-NZ19NrT58XPK5sXqXnnvtf9T5kLXSzGQlVZL9taZWeTBtXoN3xIfTdxbkQh6QSoJfJgpojRqMfhyqBAAEeiXcA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.0.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Black Han Sans&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbit&display=swap">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css" integrity="sha512-3pIirOrwegjM6erE5gPSwkUzO+3cTjpnV9lexlNZqvupR64iZBnOOTiiLPb9M36zpMScbmUNIcHUqKD47M719g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


  <!-- Custom styles for this template -->
  <link href="{{ url_for('static', filename='cover.css') }}" rel="stylesheet">
</head>

<body class="text-center">
  <div class="container custom-container">
    <header class="masthead mb-auto">
      <div class="inner">
        <h3 class="masthead-brand">당신의 면접에 행운이</h3>
        <span style="
    font-size: 1rem;
    font-family: sans-serif;
">
AI기반 면접 질문 생성 서비스
</span>
        <nav class="nav nav-masthead justify-content-center">
          <a class="nav-link active" href="#">Home</a>
          <a class="nav-link" href="#">Features</a>
          <a class="nav-link" href="#">Contact</a>
        </nav>
      </div>
    </header>
    <div class="row" style="background: #f5f5f5; margin-right:0; margin-left:0;">
      <!-- col-* 클래스를 사용하여 화면의 크기에 따라 너비를 조절 -->
      <div class="col-12 col-md-10 col-lg-8 mx-auto">

        <div class="cover-container d-flex h-100 p-3 mx-auto flex-column">


          <main role="main" class="inner cover shadow p-3 mb-4 bg-white rounded">


            <form id="personal-statement-form">
              <div class="custom-form-group" style="margin-top: 0; margin-bottom:0;">
                <label for="job_position" class="custom-label">지원하시려는 직무를 입력해주세요.</label>
                <input type="text" id="job_position" class="form-control custom-form-control"
                  placeholder="예: 소프트웨어 엔지니어, 마케팅 전문가..." required>
              </div>
              <div class="custom-form-group custom-form-control" style="margin-top:0;">
                <label for="type-select" class="custom-label">유형 선택</label>
                <select id="type-select" class="form-select" style="font-size: smaller;">
                  <option value="personal_statement_form" selected>자기소개서</option>
                  <option value="project">프로젝트</option>
                </select>
              </div>
              <div id="personal-statement-section">
                <div class="custom-form-group" style="margin-top: 0;">
                  <label for="introduction-article" class="custom-label">자기소개서 항목을 입력해주세요.</label>
                  <input type="text" id="introduction-article" class="form-control custom-form-control"
                    placeholder="예: 본 직군으로 지원을 결정하시게 된 계기를 작성해 주세요." required>
                </div>
                <div class="custom-form-group">
                  <label for="personal_statement" class="custom-label">자기소개서를 입력해주세요.</label><span
                    class="custom-label custom-span">(최대 2,000자)</span>
                    <textarea id="personal_statement" class="form-control custom-form-control" rows="12" style="font-size: 0.7rem;" placeholder="자기소개서 내용을 입력해주세요." required oninput="updateCounter(this, 2000, 'personal_counter')" required></textarea>
                    <div id="personal_counter" style="text-align: right; font-size:0.7rem;"></div>
                </div>

              </div>
              <div id="project-section" style="display:none;">
                <div class="custom-form-group">
                  <label for="project_title" class="custom-label">프로젝트 제목을 입력해주세요.</label>
                  <input type="text" id="project_title" class="form-control custom-form-control"
                    placeholder="예: AI기반 면접 질문 생성 서비스 개발 프로젝트" required>
                </div>
                <div class="custom-form-group">
                  <label for="project_description" class="custom-label">프로젝트 설명을 입력해주세요.</label><span
                  class="custom-label custom-span">(최대 2,000자)</span>
                  <textarea id="project_description" class="form-control custom-form-control" rows="12" style="font-size: 0.7rem;" placeholder="프로젝트에 대한 설명을 입력해주세요." oninput="updateCounter(this, 2000, 'description_counter')" required></textarea>
                  <div id="description_counter" style="text-align: right;"></div>
                </div>
              </div>
            
              <button type="submit" class="btn-primary" id="generate-button" style="padding: 5px 0px;width: -webkit-fill-available;margin: 0px 1rem;">질문 생성</button>
              <div id="loading-message" style="display: none;">
                <span class="custom-form-control">질문을 생성 중입니다, 잠시만 기다려주세요</span><br>
                <div class="spinner-border text-primary" role="status" style="width:1rem; height:1rem;">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
          </form>
          <div id="questions" class="mt-4 accordion"></div>

          

          <div class="justify-content-between mt-3" id="save-button-div" style="display:none !important; float: left;">
            <button type="button" class="btn-info custom-form-group" id="copy-to-clipboard" style="margin: 10px 5px 10px 5px;padding: 5px;">결과 복사</button>
            <button type="button" class="btn-info custom-form-group" id="save-question-image" style="margin: 10px 5px 10px 5px;padding: 5px;">결과 이미지 저장</button>
            <button type="button" class="btn-info custom-form-group" id="save-question-tip-image" style="margin: 10px 5px 10px 5px;padding: 5px;">질문+팁 이미지 저장</button>
          </div>

          
          </main>

          
        </div>
      </div>
    </div>
    <footer>
      <div class="footer-content">
          <h3>Developed by Lee Junhyung</h3>
          <p>합격을 응원합니다.</p>
      </div>
      <div class="footer-bottom">
          <p style="margin:0;">copyright &copy; <a href="https://github.com/with-developer/Interview-Question-Generator/blob/main/LICENSE">이준형 (MIT License)</a>  </p>
      </div>
  
  </footer>
  </div>

  





<script>
  function updateCounter(element, limit, counterId) {
    const counter = document.getElementById(counterId);
    const currentLength = element.value.length;

    if (currentLength > limit) {
      element.value = element.value.substring(0, limit);
    }

    counter.textContent = `${element.value.length} / ${limit}`;
  }

  let timerInterval; // 타이머를 저장할 변수
  $('#personal-statement-form').submit(function (e) {
    e.preventDefault();

    $("#generate-button").prop("disabled", true);
    $("#loading-message").show();

    let timeLeft = 60;
    timerInterval = setInterval(function() {
      $("#generate-button").text(`다음 질문 생성 가능: ${timeLeft}s`);
      timeLeft -= 1;
  
      if (timeLeft < 0) {
        clearInterval(timerInterval);
        $("#generate-button").text("질문 생성");
        $("#generate-button").prop("disabled", false);
      }
    }, 1000);
  
    // 공통으로 사용되는 job_position 값
    let job_position = $('#job_position').val();
    let isValid = true;
    let missingFields = [];

  
    // 현재 선택된 select option
    let selectedValue = $("#type-select").val();
  
    // 데이터 초기화
    let dataToSend = {
      job_position: job_position,
      type: selectedValue
    };
    // 공통 필드 검증
    if ($('#job_position').val() === '') {
      isValid = false;
      missingFields.push('지원하려는 직무');
    }

    // 자기소개서가 선택되어 있는 경우
    if (selectedValue === "personal_statement_form") {
      if ($('#introduction-article').val() === '') {
        isValid = false;
        missingFields.push('자기소개서 항목');
      }
      if ($('#personal_statement').val() === '') {
        isValid = false;
        missingFields.push('자기소개서');
      }
    } 
    // 프로젝트가 선택되어 있는 경우
    else if (selectedValue === "project") {
      if ($('#project_title').val() === '') {
        isValid = false;
        missingFields.push('프로젝트 제목');
      }
      if ($('#project_description').val() === '') {
        isValid = false;
        missingFields.push('프로젝트 설명');
      }
    }

    if (!isValid) {
      $("#loading-message").hide();
      clearInterval(timerInterval); // 타이머를 초기화
      $("#generate-button").text("질문 생성");
      $("#generate-button").prop("disabled", false); // 버튼을 다시 활성화
      alert('다음 필드가 누락되었습니다: ' + missingFields.join(', '));
      return;
    }
  
    // 자기소개서가 선택되어 있는 경우
    if (selectedValue === "personal_statement_form") {
      dataToSend.introduction_article = $('#introduction-article').val();
      dataToSend.personal_statement = $('#personal_statement').val();
    } 
    // 프로젝트가 선택되어 있는 경우
    else if (selectedValue === "project") {
      dataToSend.project_title = $('#project_title').val();
      dataToSend.project_description = $('#project_description').val();
    }
  
    // 백엔드로 데이터 전송
    $.post('/generate_questions', dataToSend)
  .done(function (data) {
      // "생성된 질문" 제목 추가
      let questionsHtml = '<h3>생성된 질문</h3>';
    
    data.questions.forEach(function(q, index) {
      questionsHtml += `
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading${index}">
            <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#collapse${index}">
              ${index + 1}. ${q.question}
            </button>
          </h2>
          <div id="collapse${index}" class="accordion-collapse collapse"> <!-- data-bs-parent 속성 제거 -->
            <div class="card-body" style="text-align: initial;">
              <p>답변 팁: ${q.tip}</p>
            </div>
          </div>
        </div>
      `;
    });
    $("#loading-message").hide();
    $('#questions').html(questionsHtml);
    $('#save-button-div').show();
  })
  .fail(function (jqXHR) {
    // 실패 시 에러 메시지 출력
    let errorMsg = "알 수 없는 오류가 발생했습니다.";
    if (jqXHR.status === 429) {
      errorMsg = "1분에 1번의 요청만 가능합니다.";
    } else if (jqXHR.responseJSON && jqXHR.responseJSON.error) {
      errorMsg = jqXHR.responseJSON.error;
    }
    alert(errorMsg);
    $("#loading-message").hide();
    clearInterval(timerInterval); // 타이머를 초기화
    $("#generate-button").text("질문 생성");
    $("#generate-button").prop("disabled", false); // 버튼을 다시 활성화
  });
});

$(document).ready(function () {
  // 초기 상태 설정 (자기소개서 입력칸이 기본으로 보이도록)
  $("#project-section").hide();
  setRequiredFields('personal_statement_form');

  // select 태그의 변경을 감지
  $("#type-select").change(function () {
    var selectedValue = $(this).val();
    setRequiredFields(selectedValue); // required 속성 설정

    if (selectedValue === "personal_statement_form") {
      $("#personal-statement-section").show();
      $("#project-section").hide();
    } else if (selectedValue === "project") {
      $("#personal-statement-section").hide();
      $("#project-section").show();
    }
  });
});

// required 속성을 동적으로 설정
function setRequiredFields(selectedValue) {
  if (selectedValue === 'personal_statement_form') {
    $('#introduction-article').prop('required', true);
    $('#personal_statement').prop('required', true);
    $('#project_title').prop('required', false);
    $('#project_description').prop('required', false);
  } else if (selectedValue === 'project') {
    $('#introduction-article').prop('required', false);
    $('#personal_statement').prop('required', false);
    $('#project_title').prop('required', true);
    $('#project_description').prop('required', true);
  }
}

// Toastr 설정
toastr.options = {
  "positionClass": "toast-bottom-center",
  // 추가적으로 원하는 설정을 여기에 넣을 수 있습니다.
};

// 클립보드 복사 버튼 이벤트 핸들러
$('#copy-to-clipboard').click(function() {
  let copyText = '';
  $('#questions .accordion-item').each(function(index) {
    let question = $(this).find('.accordion-button').text().trim();
    let tip = $(this).find('.card-body p').text().trim();
    
    copyText += `${index + 1}번 질문: ${question}\n`;
    copyText += `답변 팁: ${tip}\n\n`;
  });
  alert("복사 전 alert")
  toastr.success('복사 전 toastr');
  // 클립보드에 복사
  navigator.clipboard.writeText(copyText).then(function() {
    // Toastr 메시지 띄우기
    toastr.success('결과가 클립보드에 복사되었습니다.');
  }).catch(function(err) {
    toastr.error('클립보드 복사에 실패했습니다.');
  });
});
</script>



</body>

</html>